{"ast":null,"code":"import { createCommentVNode as _createCommentVNode, resolveComponent as _resolveComponent, createVNode as _createVNode, createElementVNode as _createElementVNode, openBlock as _openBlock, createElementBlock as _createElementBlock } from \"vue\";\nconst _hoisted_1 = {\n  class: \"h-screen relative\"\n};\n\nconst _hoisted_2 = /*#__PURE__*/_createElementVNode(\"div\", {\n  id: \"mapid\",\n  class: \"h-full z-[1]\"\n}, null, -1\n/* HOISTED */\n);\n\nexport function render(_ctx, _cache, $props, $setup, $data, $options) {\n  const _component_MapFeatures = _resolveComponent(\"MapFeatures\");\n\n  return _openBlock(), _createElementBlock(\"div\", _hoisted_1, [_createCommentVNode(\" <GeoErrorModal\\n      v-if=\\\"geoError\\\"\\n      :geoErrorMsg=\\\"geoErrorMsg\\\"\\n      @closeGeoError=\\\"closeGeoError\\\"\\n    /> \"), _createVNode(_component_MapFeatures, {\n    fetchCoords: $setup.fetchCoords,\n    coords: $setup.coords,\n    onToggleSearchResults: $setup.toggleSearchResults,\n    onGetGeolocation: $setup.getGeolocation,\n    onPlotResult: $setup.plotResult,\n    onRemoveResult: $setup.removeResult,\n    searchResults: $setup.searchResults,\n    class: \"w-full md:w-auto absolute md:top-[40px] md:left-[60px] z-[2]\"\n  }, null, 8\n  /* PROPS */\n  , [\"fetchCoords\", \"coords\", \"onToggleSearchResults\", \"onGetGeolocation\", \"onPlotResult\", \"onRemoveResult\", \"searchResults\"]), _hoisted_2]);\n}","map":{"version":3,"sources":["/Users/muhammad/Ayaz/express-vue3-tailwind-map/client/src/views/HomeView.vue"],"names":[],"mappings":";;AACO,EAAA,KAAK,EAAC;;;gCAgBT,mBAAA,CAA2C,KAA3C,EAA2C;AAAtC,EAAA,EAAE,EAAC,OAAmC;AAA3B,EAAA,KAAK,EAAC;AAAqB,CAA3C,E,IAAA,E;;AAAA,C;;;;;uBAhBF,mBAAA,CAiBM,KAjBN,EAAA,UAAA,EAiBM,CAhBJ,mBAAA,CAAA,+HAAA,CAgBI,EAXJ,YAAA,CASE,sBATF,EASE;AARC,IAAA,WAAW,EAAE,MAAA,CAAA,WAQd;AAPC,IAAA,MAAM,EAAE,MAAA,CAAA,MAOT;AANC,IAAA,qBAAmB,EAAE,MAAA,CAAA,mBAMtB;AALC,IAAA,gBAAc,EAAE,MAAA,CAAA,cAKjB;AAJC,IAAA,YAAU,EAAE,MAAA,CAAA,UAIb;AAHC,IAAA,cAAY,EAAE,MAAA,CAAA,YAGf;AAFC,IAAA,aAAa,EAAE,MAAA,CAAA,aAEhB;AADA,IAAA,KAAK,EAAC;AACN,GATF,E,IAAA,E;;AAAA,I,yHAAA,CAWI,EADJ,UACI,CAjBN,C","sourcesContent":["<template>\n  <div class=\"h-screen relative\">\n    <!-- <GeoErrorModal\n      v-if=\"geoError\"\n      :geoErrorMsg=\"geoErrorMsg\"\n      @closeGeoError=\"closeGeoError\"\n    /> -->\n    <MapFeatures\n      :fetchCoords=\"fetchCoords\"\n      :coords=\"coords\"\n      @toggleSearchResults=\"toggleSearchResults\"\n      @getGeolocation=\"getGeolocation\"\n      @plotResult=\"plotResult\"\n      @removeResult=\"removeResult\"\n      :searchResults=\"searchResults\"\n      class=\"w-full md:w-auto absolute md:top-[40px] md:left-[60px] z-[2]\"\n    />\n    <div id=\"mapid\" class=\"h-full z-[1]\"></div>\n  </div>\n</template>\n\n<script>\nimport leaflet from \"leaflet\";\nimport { onMounted, ref } from \"vue\";\n// import GeoErrorModal from \"../components/GeoErrorModal.vue\";\nimport MapFeatures from \"../components/MapFeatures.vue\";\nexport default {\n  name: \"HomeView\",\n  components: { GeoErrorModal, MapFeatures },\n  setup() {\n    let map;\n    onMounted(() => {\n      // init map\n      map = leaflet\n        .map(\"mapid\", {\n          zoomControl: false,\n        })\n        .setView([28.538336, -81.379234], 10);\n\n      // add tile layers\n      leaflet\n        .tileLayer(\n          `https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token=${process.env.VUE_APP_API_KEY}`,\n          {\n            maxZoom: 18,\n            id: \"mapbox/streets-v11\",\n            tileSize: 512,\n            zoomOffset: -1,\n            accessToken: process.env.VUE_APP_API_KEY,\n          }\n        )\n        .addTo(map);\n\n      map.on(\"moveend\", () => {\n        closeSearchResults();\n      });\n\n      // get users location\n      getGeolocation();\n    });\n\n    const coords = ref(null);\n    const fetchCoords = ref(null);\n    const geoMarker = ref(null);\n    const geoError = ref(null);\n    const geoErrorMsg = ref(null);\n\n    const getGeolocation = () => {\n      // if function is called, only run if we dont have coords\n      if (!coords.value) {\n        // check to see if we have coods in session sotrage\n        if (sessionStorage.getItem(\"coords\")) {\n          coords.value = JSON.parse(sessionStorage.getItem(\"coords\"));\n          plotGeoLocation(coords.value);\n          return;\n        }\n\n        // else get coords from geolocation API\n        fetchCoords.value = true;\n        navigator.geolocation.getCurrentPosition(setCoords, getLocError);\n        return;\n      }\n\n      // otherwise, remove location\n      coords.value = null;\n      sessionStorage.removeItem(\"coords\");\n      map.removeLayer(geoMarker.value);\n    };\n\n    const setCoords = (pos) => {\n      // stop fetching\n      fetchCoords.value = null;\n\n      // set coords in session storage\n      const setSessionCoords = {\n        lat: pos.coords.latitude,\n        lng: pos.coords.longitude,\n      };\n      sessionStorage.setItem(\"coords\", JSON.stringify(setSessionCoords));\n\n      // set ref coords value\n      coords.value = setSessionCoords;\n\n      plotGeoLocation(coords.value);\n    };\n\n    const getLocError = (error) => {\n      // stop fetching coords\n      fetchCoords.value = null;\n      geoError.value = true;\n      geoErrorMsg.value = error.message;\n    };\n\n    const plotGeoLocation = (coords) => {\n      // create custom marker\n      const customMarker = leaflet.icon({\n        iconUrl: require(\"../assets/map-marker-red.svg\"),\n        iconSize: [35, 35],\n      });\n\n      // create new marker with coords and custom marker\n      geoMarker.value = leaflet\n        .marker([coords.lat, coords.lng], { icon: customMarker })\n        .addTo(map);\n\n      // set map view to current location\n      map.setView([coords.lat, coords.lng], 10);\n    };\n\n    const resultMarker = ref(null);\n    const plotResult = (coords) => {\n      // If there is already a marker, remove it. Only allow 1\n      if (resultMarker.value) {\n        map.removeLayer(resultMarker.value);\n      }\n      const customMarker = leaflet.icon({\n        iconUrl: require(\"../assets/map-marker-blue.svg\"),\n        iconSize: [35, 35], // size of the icon\n      });\n      resultMarker.value = leaflet\n        .marker([coords.coordinates[1], coords.coordinates[0]], { icon: customMarker })\n        .addTo(map);\n      map.setView([coords.coordinates[1], coords.coordinates[0]], 13);\n    };\n\n    const removeResult = () => {\n      map.removeLayer(resultMarker.value);\n    };\n\n    const closeGeoError = () => {\n      geoErrorMsg.value = null;\n      geoError.value = null;\n    };\n\n    const searchResults = ref(null);\n    const toggleSearchResults = () => {\n      searchResults.value = !searchResults.value;\n    };\n    const closeSearchResults = () => {\n      searchResults.value = null;\n    };\n\n    return {\n      geoError,\n      closeGeoError,\n      geoErrorMsg,\n      fetchCoords,\n      coords,\n      getGeolocation,\n      plotResult,\n      searchResults,\n      toggleSearchResults,\n      closeSearchResults,\n      removeResult,\n    };\n  },\n};\n</script>\n"],"sourceRoot":""},"metadata":{},"sourceType":"module"}